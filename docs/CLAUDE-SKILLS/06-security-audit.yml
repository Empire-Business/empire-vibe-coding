name: "security-audit"
description: "Audita cÃ³digo e dependÃªncias buscando vulnerabilidades de seguranÃ§a"
parameters:
  - name: "scope"
    description: "Escopo da auditoria"
    required: false
    type: "string"
    default: "full"
    enum: ["full", "auth", "database", "dependencies", "frontend", "backend"]
  - name: "includeNpmAudit"
    description: "Incluir auditoria de dependÃªncias npm"
    required: false
    type: "boolean"
    default: true
  - name: "checkOWASP"
    description: "Verificar OWASP Top 10"
    required: false
    type: "boolean"
    default: true
  - name: "severityThreshold"
    description: "NÃ­vel mÃ­nimo de severidade a reportar"
    required: false
    type: "string"
    default: "medium"
    enum: ["critical", "high", "medium", "low", "info"]
  - name: "generateReport"
    description: "Gerar relatÃ³rio detalhado"
    required: false
    type: "boolean"
    default: true

steps:
  - name: "scan_dependencies"
    description: "Scaneia dependÃªncias com npm audit"

  - name: "scan_code"
    description: "Scaneia cÃ³digo fonte"

  - name: "check_auth"
    description: "Verifica implementaÃ§Ã£o de autenticaÃ§Ã£o"

  - name: "check_database"
    description: "Verifica RLS e queries"

  - name: "check_headers"
    description: "Verifica security headers"

  - name: "generate_report"
    description: "Gera relatÃ³rio de vulnerabilidades"

examples:
  - scope: "full"
    severityThreshold: "high"
    includeNpmAudit: true

output_format: |
  ## Security Audit Report

  **Data:** [YYYY-MM-DD]
  **Escopo:** [full/auth/database/dependencies/frontend/backend]

  ---

  ### Resumo Executivo

  | Severity | Count |
  |----------|-------|
  | ğŸ”´ Critical | 0 |
  | ğŸŸ  High | 2 |
  | ğŸŸ¡ Medium | 5 |
  | ğŸŸ¢ Low | 10 |

  **Status:** âœ… APROVADO / âš ï¸ ATENÃ‡ÃƒO / âŒ BLOQUEADO

  ---

  ### ğŸ”´ Critical Issues

  *(None found - Good job!)*

  ---

  ### ğŸŸ  High Severity Issues

  **1. [Issue Name]**
  - **Arquivo:** `src/path/file.ts`
  - **Linha:** 42
  - **CWE:** [CWE-XXX]
  - **DescriÃ§Ã£o:** [DescriÃ§Ã£o da vulnerabilidade]
  - **CÃ³digo VulnerÃ¡vel:**
    ```typescript
    [codigo]
    ```
  - **CorreÃ§Ã£o Sugerida:**
    ```typescript
    [codigo_corrigido]
    ```
  - **Severity:** High

  ---

  ### ğŸŸ¡ Medium Severity Issues

  **1. [Issue Name]**
  - **Arquivo:** `src/path/file.ts`
  - **Linha:** 67
  - **CWE:** [CWE-XXX]
  - **DescriÃ§Ã£o:** [DescriÃ§Ã£o]
  - **CorreÃ§Ã£o:**
    ```typescript
    [codigo_corrigido]
    ```

  ---

  ### DependÃªncias

  | Package | Current | Latest | Severity |
  |---------|---------|--------|----------|
  | react | 18.2.0 | 18.3.1 | Medium |

  **RecomendaÃ§Ã£o:** `npm update`

  ---

  ### OWASP Top 10 Checklist

  | Category | Status | Notes |
  |----------|--------|-------|
  | A1: Injection | âœ… | Parameterized queries |
  | A2: Auth | âœ… | MFA enabled |
  | A3: Sensitive Data | âš ï¸ | Logs contain user email |
  | A4: XXE | âœ… | Parser configured |
  | A5: Broken Access | âœ… | RLS policies in place |
  | ... | ... | ... |

  ---

  ### RecomendaÃ§Ãµes

  **Imediato:**
  - [ ] Corrigir issues High severity
  - [ ] Atualizar dependÃªncias

  **Curto Prazo:**
  - [ ] Corrigir issues Medium severity
  - [ ] Revisar logs por dados sensÃ­veis

  **Longo Prazo:**
  - [ ] Implementar automated security scanning
  - [ ] Setup dependabot

checklist:
  owasp:
    - "Injection: Use parameterized queries, Zod validation"
    - "Auth: JWT validation, session management"
    - "Sensitive: Encrypt at rest, HTTPS only"
    - "XXE: Disable entity parsing"
    - "Access: RLS policies, auth checks"
    - "Security: CSP, headers, rate limiting"
    - "Data: Validation, sanitization"
    - "Logging: Structured logging, no PII"
    - "Monitoring: Alerts, dashboards"

  dependencies:
    - "npm audit regularmente"
    - "Dependabot configurado"
    - "Lockfile atualizado"
    - "LicenÃ§as verificadas"
