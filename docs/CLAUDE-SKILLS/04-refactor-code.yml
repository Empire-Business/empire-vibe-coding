name: "refactor-code"
description: "Refatora código melhorando readability, performance e maintainability"
parameters:
  - name: "filePath"
    description: "Caminho do arquivo a ser refatorado"
    required: true
    type: "string"
  - name: "focus"
    description: "Área principal de foco da refatoração"
    required: false
    type: "string"
    default: "all"
    enum: ["readability", "performance", "maintainability", "all"]
  - name: "preserveBehavior"
    description: "Garantir que comportamento externo não mude"
    required: false
    type: "boolean"
    default: true
  - name: "extractFunctions"
    description: "Extrair funções menores de funções longas"
    required: false
    type: "boolean"
    default: true
  - name: "addTypes"
    description: "Melhorar tipagem TypeScript"
    required: false
    type: "boolean"
    default: true
  - name: "updateTests"
    description: "Atual/adicionar testes correspondentes"
    required: false
    type: "boolean"
    default: true

steps:
  - name: "analyze_code"
    description: "Analisa código fonte identificando code smells"

  - name: "identify_smells"
    description: "Identifica padrões problemáticos e oportunidades"

  - name: "plan_refactoring"
    description: "Planeja sequência de refatorações"

  - name: "extract_components"
    description: "Extrai componentes/functions menores"

  - name: "improve_types"
    description: "Melhora tipagem com Typescript strict"

  - name: "write_refactored"
    description: "Escreve código refatorado"

  - name: "update_tests"
    description: "Atualiza/adiciona testes"

examples:
  - filePath: "src/lib/utils.ts"
    focus: "maintainability"
    extractFunctions: true

  - filePath: "src/components/forms/ComplexForm.tsx"
    focus: "all"
    preserveBehavior: true

output_format: |
  ## Refatoração: [filename]

  **Foco:** [readability/performance/maintainability/all]
  **Data:** [YYYY-MM-DD]

  ---

  ### Code Smells Identificados

  | Smell | Severidade | Localização |
  |-------|------------|------------|
  | Função longa | Alta | linha 45-120 |
  | Duplicação | Média | linhas 23-28, 89-94 |
  | Nomes ruins | Baixa | `data`, `temp` |
  | Magic numbers | Média | linha 67 |

  ---

  ### Mudanças Realizadas

  **1. Função Extraída**
  ```typescript
  // Antes: 80 linhas
  function processOrder(order) {
    // validação, cálculo, persistência, notificação
  }

  // Depois: 3 funções de 20 linhas cada
  function validateOrder(order) { /* ... */ }
  function calculateOrderTotals(order) { /* ... */ }
  async function persistOrder(order) { /* ... */ }
  async function notifyOrderPlaced(order) { /* ... */ }
  ```

  **2. Tipagem Melhorada**
  ```typescript
  // Antes
  function processOrder(data) { /* any */ }

  // Depois
  interface OrderInput {
    items: OrderItem[]
    customerId: string
  }

  function processOrder(input: OrderInput): Promise<OrderResult> { /* ... */ }
  ```

  **3. Constantes Extraídas**
  ```typescript
  // Antes
  if (role === 'admin' || role === 'superadmin') { /* ... */ }

  // Depois
  const ADMIN_ROLES = ['admin', 'superadmin'] as const
  if (ADMIN_ROLES.includes(role)) { /* ... */ }
  ```

  ---

  ### Resultado

  | Métrica | Antes | Depois |
  |---------|-------|--------|
  | Linhas | 150 | 80 |
  | Complexidade | Alta | Baixa |
  | Types | any | explícitos |
  | Testes | 0 | 5 |

  ---

  ### Arquivos Criados/Modificados

  - `src/features/.../OrderProcessor.ts` (novo)
  - `src/features/.../OrderValidator.ts` (novo)
  - `src/lib/constants.ts` (atualizado)
  - `src/types/order.ts` (novo)

principles:
  - "Boy Scout Rule: Leave code better than found"
  - "Small changes, frequent commits"
  - "Test before and after"
  - "Don't optimize prematurely"
  - "Clear > Clever"
