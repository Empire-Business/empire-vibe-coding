name: "debug-error"
description: "Diagnostica erros de runtime e propõe correções baseadas em padrões conhecidos"
parameters:
  - name: "errorMessage"
    description: "Mensagem de erro exata exibida ao usuário ou no console"
    required: true
    type: "string"
  - name: "stackTrace"
    description: "Stack trace completo do erro, preferencialmente com source maps"
    required: false
    type: "string"
  - name: "codeSnippet"
    description: "Código relevante onde o erro ocorreu (máximo 50 linhas)"
    required: false
    type: "string"
  - name: "context"
    description: "Contexto adicional: framework, biblioteca, versão, browser/device"
    required: false
    type: "string"
  - name: "stepsToReproduce"
    description: "Passos para reproduzir o erro, se disponíveis"
    required: false
    type: "string"

steps:
  - name: "parse_error"
    description: "Parse da mensagem de erro e extração de padrões"

  - name: "categorize"
    description: "Categoriza o tipo de erro (Syntax, Runtime, Type, Network, Auth, Database)"

  - name: "search_patterns"
    description: "Busca padrões conhecidos e soluções documentadas"

  - name: "analyze_context"
    description: "Analisa o contexto fornecido para refinar diagnóstico"

  - name: "propose_fix"
    description: "Propoe correção com exemplo de código"

  - name: "suggest_tests"
    description: "Sugere testes para prevenir regressão"

examples:
  - errorMessage: "TypeError: Cannot read property 'map' of undefined"
    context: "React component trying to render a list"
    solution: |
      Verificar se o array existe antes de usar .map()
      ```jsx
      // ❌ Antes
      {data.items.map(item => <Item key={item.id} {...item} />)}

      // ✅ Depois
      {data?.items?.map(item => <Item key={item.id} {...item} />)}
      // ou
      {data.items && data.items.map(item => <Item key={item.id} {...item} />)}
      ```

  - errorMessage: "Error: supabase.auth.getUser() called but no session found"
    context: "Supabase SSR authentication"
    solution: |
      Verificar se há sessão antes de chamar getUser()
      ```typescript
      const { data: { session } } = await supabase.auth.getSession()
      if (session) {
        const { data: { user } } = await supabase.auth.getUser()
      }
      ```

output_format: |
  ## Análise de Erro

  **Tipo:** [Runtime/Syntax/Type/Network/Auth/Database]
  **Severidade:** [Crítico/Alto/Médio/Baixo]

  ### Causa Raiz
  [Explicação clara do que causou o erro]

  ### Correção Proposta
  ```typescript
  [Código corrigido]
  ```

  ### Verificações Recomendadas
  - [ ] Verificar tipo da variável
  - [ ] Adicionar tratamento de null/undefined
  - [ ] Adicionar logging para debug

  ### Testes Sugeridos
  ```typescript
  // Teste para prevenir regressão
  it('should handle undefined data gracefully', () => {
    render(<Component data={undefined} />)
    expect(screen.queryByRole('list')).not.toBeInTheDocument()
  })
  ```
